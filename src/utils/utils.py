#!/usr/bin/python3

import os
import json
import logging
import logging.config
from pathlib import Path

def get_full_path(relative_path):
    """Bygger en fullständig sökväg för den givna relativa sökvägen baserat på skriptets placering."""
    base_path = os.path.dirname(__file__)  # Hämtar katalogen där detta skript finns
    return os.path.join(base_path, relative_path)

def setup_logging(default_path='config/logging.json', default_level=logging.INFO, env_key='LOG_CFG'):
    """Konfigurerar loggning baserat på en JSON-fil."""
    path = get_full_path(default_path)  # Använder get_full_path för att hitta rätt fil
    value = os.getenv(env_key, None)
    if value:
        path = value
    if Path(path).exists():
        with open(path, 'rt') as f:
            config = json.load(f)
        logging.config.dictConfig(config)
    else:
        logging.basicConfig(level=default_level)

def load_config(config_file='config/config.json'):
    """Laddar konfigurationsinställningar från en JSON-fil."""
    config_file = get_full_path(config_file)  # Använder get_full_path för att hitta rätt fil
    try:
        with open(config_file, 'r') as f:
            return json.load(f)
    except FileNotFoundError:
        logging.error(f"Konfigurationsfilen {config_file} hittades inte.")
        return {}

def save_to_file(data, filename):
    """Sparar data till en fil med förbättrad felhantering."""
    try:
        with open(filename, 'w') as f:
            json.dump(data, f, indent=4)
    except (FileNotFoundError, PermissionError) as e:
        logging.error(f"Kunde inte spara till fil {filename}: {e}")
    except Exception as e:
        logging.error(f"Oväntat fel vid sparande av fil {filename}: {e}")


def read_from_file(filename):
    """Läser data från en fil."""
    try:
        with open(filename, 'r') as f:
            return json.load(f)
    except FileNotFoundError:
        logging.error(f"Filen {filename} hittades inte.")
        return None

