#!/usr/bin/python3

import argparse
from data_collection.collector import scan_subnet
from data_analysis.analyzer import SecurityRiskAnalyzer
from report_generation.reporter import generate_report
from utils.utils import setup_logging, load_config

def main():
    # Konfigurera logging
    setup_logging()

    # Argumenthantering
    parser = argparse.ArgumentParser(description="Pentest Toolbox Main Runner")
    parser.add_argument("subnet", help="Target subnet in CIDR notation, e.g., 192.168.1.0/24")
    args=parser.parse_args()

    # Ladda eventuella konfigurationer
    config = load_config('config.json')

    # Steg 1 Datainsamling
    open_ports = scan_subnet(args.subnet, config.get('start_port', 1), config.get('end_port', 1024))

    # Steg 2 Datanalys
    analayzer = SecurityRiskAnalyzer()
    analasysis_results = analyzer.analyze_open_ports(open_ports)

    # Steg 3 Rapportering
    generate_report(analysis.results)

if __name__=='__main__':
    main()
